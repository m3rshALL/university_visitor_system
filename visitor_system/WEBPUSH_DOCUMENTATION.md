# WebPush Уведомления - Документация

## Реализованные уведомления

### 1. При регистрации визита гостя к сотруднику
**Кто получает:**
- **Принимающий сотрудник** - уведомление о том, что к нему идет гость
- **Служба безопасности (группа "Reception")** - уведомление о новой регистрации

**Содержание:**
- Заголовок: "Новый визит: [Имя гостя]"
- Текст: "К вам [зарегистрирован визит/идет гость]: [Имя]. Цель: [цель визита]"

### 2. При выходе гостя
**Кто получает:**
- **Принимающий сотрудник** - уведомление о том, что гость покинул здание
- **Служба безопасности (группа "Reception")** - уведомление о выходе

**Содержание:**
- Заголовок: "Гость покинул здание"
- Текст: "[Имя гостя] покинул здание в [время]"

### 3. При регистрации студента/абитуриента
**Кто получает:**
- **Служба безопасности (группа "Reception")** - уведомление о регистрации

**Содержание:**
- Заголовок: "Регистрация студента/абитуриента"
- Текст: "Зарегистрирован визит студента: [Имя] в [департамент]"

### 4. При выходе студента/абитуриента
**Кто получает:**
- **Служба безопасности (группа "Reception")** - уведомление о выходе

**Содержание:**
- Заголовок: "Выход студента/абитуриента"
- Текст: "Студент [Имя] покинул здание в [время]"

## Настройка

### Требования
1. Пользователь должен быть авторизован в системе
2. Пользователь должен дать разрешение на push уведомления в браузере
3. Пользователь должен подписаться на уведомления через интерфейс

### Группы пользователей
- **Reception** - группа службы безопасности, получает все уведомления о регистрации и выходе
- Принимающие сотрудники получают уведомления только о своих гостях

### Интерфейс
- Настройки WebPush доступны на главной странице сотрудника
- Кнопка "Включить уведомления" для подписки
- Статус подписки отображается в реальном времени

## Технические детали

### Файлы
- `notifications/utils.py` - функции отправки WebPush
- `visitors/views.py` - интеграция уведомлений в процессы регистрации/выхода
- `static/js/webpush.js` - JavaScript для управления подписками
- `static/js/serviceworker.js` - Service Worker для обработки push событий

### Данные уведомлений
Каждое уведомление содержит дополнительные данные:
```json
{
  "visit_id": 123,
  "type": "guest_visit|security_notification", 
  "action": "created|checked_out|guest_exit|student_registered|student_exit"
}
```

### Логирование
Все отправки и ошибки WebPush логируются в Django logs с префиксом компонента.
