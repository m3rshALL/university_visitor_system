# Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ñ Ğ¾Ğ´Ğ½Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ¼/Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¾Ğ¼

## âœ… Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾

### ğŸ“‹ Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ:**
> "Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´Ğ°Ñ‚ÑŒ ÑÑ€Ğ°Ğ·Ñƒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ½Ğ° Ğ²ÑĞµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¾Ğ´Ğ½Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´ Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´"

**Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
1. Access Level Group: "Visitors Access" (09:00-22:00)
2. Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°: 4 access points (Ğ¢ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´, Ğ¢ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ Ğ²Ñ‹Ñ…Ğ¾Ğ´, ĞŸĞ°Ñ€ĞºĞ¸Ğ½Ğ³ Ğ²Ñ…Ğ¾Ğ´, ĞŸĞ°Ñ€ĞºĞ¸Ğ½Ğ³ Ğ²Ñ‹Ñ…Ğ¾Ğ´)
3. Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°: Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ’ - Ğ“Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ¸ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· (Ğ²ÑĞµĞ³Ğ¾ 2 Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ°)
4. ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: ĞÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¾ 22:00 Ñ‚Ğ¾Ğ³Ğ¾ Ğ¶Ğµ Ğ´Ğ½Ñ
5. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³: ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ñ‹ Ñ‡ĞµÑ€ĞµĞ· API `/acs/v1/door/events`
6. ĞĞ²Ñ‚Ğ¾Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: ĞŸĞ¾ÑĞ»Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ğ¾Ğ·Ğ²Ğ°Ğ½

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### Ğ¤Ğ°Ğ·Ğ° 1: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°

#### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (`visitor_system/conf/base.py`)
```python
# HikCentral Access Control Settings
HIKCENTRAL_GUEST_ACCESS_GROUP_ID = '7'  # ID Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ "Visitors Access"
HIKCENTRAL_ACCESS_END_TIME = '22:00'    # Ğ’Ñ€ĞµĞ¼Ñ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
```

#### Ğ¡ĞµÑ€Ğ²Ğ¸ÑĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (`hikvision_integration/services.py`)

**1. `assign_access_level_to_person()`** (lines 1466-1558)
- ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ access level group Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğµ
- API: `POST /acs/v1/privilege/group/single/addPersons`
- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ: `POST /visitor/v1/auth/reapplication`
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: `True/False`

**2. `revoke_access_level_from_person()`** (lines 1561-1655)
- ĞÑ‚Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ access level Ñƒ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ñ‹
- API: `POST /acs/v1/privilege/group/single/deletePersons`
- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ: `POST /visitor/v1/auth/reapplication`

**3. `get_door_events()`** (lines 1658-1741)
- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚Ñ‹
- API: `POST /acs/v1/door/events`
- ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹: person_id, start_time, end_time, event_type
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: dict Ñ Ğ¿Ğ¾Ğ»ĞµĞ¼ 'list' (Ğ¼Ğ°ÑÑĞ¸Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹)

#### Celery Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° (`hikvision_integration/tasks.py`)

**`assign_access_level_task(task_id)`** (lines 282-387)
- Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€: Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ¾Ñ‚Ğ¾
- Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: task_id (HikAccessTask)
- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚: person_id Ğ¸Ğ· payload/Guest/Visit
- Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:
  1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ HIKCENTRAL_GUEST_ACCESS_GROUP_ID Ğ¸Ğ· settings
  2. Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ assign_access_level_to_person()
  3. ĞŸĞ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Visit.access_granted = True
  4. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ task.status = 'success'/'failed'
- ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ: 'hikvision'

#### Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Django views (`visitors/views.py`)

**create_visit()** (lines 158-193):
```python
# ĞŸĞ¾ÑĞ»Ğµ enroll_face_task ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ access_task
access_task = HikAccessTask.objects.create(
    guest=guest,
    visit=visit,
    task_type='assign_access',
    status='pending',
    payload={'person_id': person_id}
)

transaction.on_commit(lambda: assign_access_level_task.apply_async(
    args=[access_task.id],
    queue='hikvision'
))
```

**finalize_guest_invitation()** (lines 2217-2254):
- ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ñ‹Ñ… Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ¾Ğ²

---

### Ğ¤Ğ°Ğ·Ğ° 2: ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°

#### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (`visitors/models.py`)

**ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Visit** (lines 207-235):
```python
# ĞŸĞ¾Ğ»Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚
access_granted = models.BooleanField(default=False)
access_revoked = models.BooleanField(default=False)
first_entry_detected = models.DateTimeField(blank=True, null=True)
first_exit_detected = models.DateTimeField(blank=True, null=True)
entry_count = models.IntegerField(default=0)
exit_count = models.IntegerField(default=0)
hikcentral_person_id = models.CharField(max_length=50, blank=True, null=True)
```

**ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:**
- `0040_visit_access_granted_visit_access_revoked_and_more.py` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ»Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ°
- `0041_visit_hikcentral_person_id.py` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»Ğµ person_id

#### ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° (`hikvision_integration/tasks.py`)

**`monitor_guest_passages_task()`** (lines 398-598)

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€:** Celery Beat, ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. **ĞŸĞ¾Ğ¸ÑĞº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ¾Ğ²:**
   ```python
   Visit.objects.filter(
       access_granted=True,
       access_revoked=False,
       status__in=['EXPECTED', 'CHECKED_IN']
   )
   ```

2. **ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²:**
   - Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº `/acs/v1/door/events` Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
   - Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ person_id
   - event_type: 1 = Ğ²Ñ…Ğ¾Ğ´, 2 = Ğ²Ñ‹Ñ…Ğ¾Ğ´

3. **ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²:**
   - ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (ISO 8601 â†’ datetime)
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ last check (Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)
   - Ğ˜Ğ½ĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²: entry_count, exit_count
   - Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ first_entry_detected, first_exit_detected

4. **ĞĞ²Ñ‚Ğ¾Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ’):**
   ```python
   if visit.first_exit_detected and not visit.access_revoked:
       success = revoke_access_level_from_person(
           session, person_id, access_group_id, access_type=1
       )
       if success:
           visit.access_revoked = True
           visit.save()
   ```

5. **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
   - INFO: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ñ… Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ¾Ğ², ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
   - WARNING: Ğ’Ğ¸Ğ·Ğ¸Ñ‚Ñ‹ Ğ±ĞµĞ· person_id, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°
   - ERROR: ĞĞµÑƒĞ´Ğ°Ñ‡Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°

#### Celery Beat Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (`visitor_system/celery.py`)

```python
'monitor-guest-passages': {
    'task': 'hikvision_integration.tasks.monitor_guest_passages_task',
    'schedule': crontab(minute='*/10'),  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
}
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹

**1. `create_test_visit.py`** - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ°
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Guest, Visit, HikCentral Person
- ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ access level
- ĞŸĞ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ visit.access_granted = True
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Visit ID, Person ID, Access Group ID

**2. `test_monitoring_task.py`** - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
- ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ñ‹ Ñ access_granted=True
- Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ door/events Ñ‡ĞµÑ€ĞµĞ· API
- Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²

**3. `test_run_monitoring_task.py`** - Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ monitor_guest_passages_task() Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
- Ğ˜Ğ¼Ğ¸Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Celery Beat

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

#### Ğ¢ĞµÑÑ‚ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ° Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼
```
âœ… Guest ÑĞ¾Ğ·Ğ´Ğ°Ğ½: Test Monitoring 1759408246 (ID=200)
âœ… Visit ÑĞ¾Ğ·Ğ´Ğ°Ğ½ (ID=182)
âœ… Person ÑĞ¾Ğ·Ğ´Ğ°Ğ½: ID=8512, Employee No=1759408246
âœ… Access level Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½ (group_id=7)
âœ… Visit.access_granted = True
```

#### Ğ¢ĞµÑÑ‚ 2: ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²
```
âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ¾Ğ²: 2
ğŸ“‹ Visit ID: 182
   Guest: Test Monitoring 1759408246
   Status: CHECKED_IN
   Access granted: True
   Access revoked: False
   Entry count: 0
   Exit count: 0
```

#### Ğ¢ĞµÑÑ‚ 3: Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
```
INFO: HikCentral: monitor_guest_passages_task started
INFO: HikCentral: Monitoring 2 active visits
INFO: HikCentral: monitor_guest_passages_task completed
âœ… Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!
```

---

## ğŸ“Š Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ     â”‚
â”‚ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ° (Django) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Create Visit         â”‚
â”‚ 2. Create Guest         â”‚
â”‚ 3. Upload Photo         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ enroll_face_task()       â”‚
â”‚ (Celery)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ assign_access_level_task â”‚
â”‚ (Celery)                 â”‚
â”‚                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ HikCentral API:      â”‚ â”‚
â”‚ â”‚ - addPersons         â”‚ â”‚
â”‚ â”‚ - reapplication      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚
â”‚ Visit.access_granted=Trueâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ“Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ monitor_guest_passages_task()    â”‚
â”‚ (Celery Beat, ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚)   â”‚
â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ HikCentral API:               â”‚ â”‚
â”‚ â”‚ - GET /door/events            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:                       â”‚ â”‚
â”‚ â”‚ 1. ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ entry/exit         â”‚ â”‚
â”‚ â”‚ 2. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ first_*_detectedâ”‚ â”‚
â”‚ â”‚ 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: exit_detected?   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (ĞµÑĞ»Ğ¸ first_exit_detected)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ revoke_access_level()    â”‚
â”‚                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ HikCentral API:      â”‚ â”‚
â”‚ â”‚ - deletePersons      â”‚ â”‚
â”‚ â”‚ - reapplication      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚
â”‚ Visit.access_revoked=Trueâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” API Endpoints Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ

### HikCentral Professional API v1

**1. ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°**
```http
POST /acs/v1/privilege/group/single/addPersons
Content-Type: application/json

{
  "personIds": ["8512"],
  "groupId": "7",
  "accessType": 1
}

Response: {"code": "0", "msg": "Success"}
```

**2. ĞÑ‚Ğ·Ñ‹Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°**
```http
POST /acs/v1/privilege/group/single/deletePersons
Content-Type: application/json

{
  "personIds": ["8512"],
  "groupId": "7",
  "accessType": 1
}

Response: {"code": "0", "msg": "Success"}
```

**3. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹**
```http
POST /visitor/v1/auth/reapplication
Content-Type: application/json

{}

Response: {"code": "0", "msg": "Success"}
```

**4. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²**
```http
POST /acs/v1/door/events
Content-Type: application/json

{
  "startTime": "2025-10-02T12:00:00+00:00",
  "endTime": "2025-10-02T13:00:00+00:00",
  "personId": "8512",
  "pageNo": 1,
  "pageSize": 100
}

Response: {
  "code": "0",
  "msg": "Success",
  "data": {
    "list": [
      {
        "eventType": 1,  // 1=Ğ²Ñ…Ğ¾Ğ´, 2=Ğ²Ñ‹Ñ…Ğ¾Ğ´
        "eventTime": "2025-10-02T12:30:15+00:00",
        "doorName": "Ğ¢ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´",
        "personId": "8512"
      }
    ],
    "total": 1
  }
}
```

---

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ² production

### ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

**1. Django App (ASGI)**
```bash
poetry run gunicorn visitor_system.asgi:application \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000
```

**2. Celery Worker**
```bash
poetry run celery -A visitor_system worker \
  --loglevel=info \
  --queue=hikvision,default
```

**3. Celery Beat (Scheduler)**
```bash
poetry run celery -A visitor_system beat \
  --loglevel=info
```

**4. Redis (Broker)**
```bash
docker run -d -p 6379:6379 redis:latest
```

**5. PostgreSQL (Database)**
```bash
docker run -d -p 5432:5432 \
  -e POSTGRES_DB=visitor_system \
  -e POSTGRES_PASSWORD=secret \
  postgres:15
```

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

```env
# Django
DJANGO_SETTINGS_MODULE=visitor_system.conf.prod
DJANGO_SECRET_KEY=your-secret-key
IIN_ENCRYPTION_KEY=your-base64-urlsafe-32-bytes-key

# Database
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=visitor_system
POSTGRES_USER=postgres
POSTGRES_PASSWORD=secret

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# Celery
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# HikCentral
HIKCENTRAL_GUEST_ACCESS_GROUP_ID=7
HIKCENTRAL_ACCESS_END_TIME=22:00
```

---

## ğŸ“ˆ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

### Prometheus Metrics

**1. Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°**
```python
hikcentral_access_assignments_total{status="success"}
hikcentral_access_assignments_total{status="failed"}
```

**2. Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚**
```python
hikcentral_door_events_total{event_type="entry"}
hikcentral_door_events_total{event_type="exit"}
```

**3. Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº**
```python
hikcentral_access_revocations_total{reason="first_exit"}
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
- INFO: ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° (Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ, Ğ¾Ñ‚Ğ·Ñ‹Ğ², Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³)
- WARNING: Ğ’Ğ¸Ğ·Ğ¸Ñ‚Ñ‹ Ğ±ĞµĞ· person_id, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°
- ERROR: ĞĞµÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ğµ API Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹, ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ²:**
```
INFO: HikCentral: Successfully assigned access level to person 8512
INFO: Visit 182: First EXIT detected at 2025-10-02T14:30:00
INFO: Visit 182: Access revoked successfully after first exit
WARNING: Visit 181: No hikcentral_person_id
ERROR: Visit 180: Failed to revoke access
```

---

## âœ… Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

- [x] Access Level Group ID=7 Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ² HCP
- [x] 4 access point Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ñ‹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ "Visitors Access"
- [x] Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹: 09:00-22:00
- [x] Settings Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² `conf/base.py`
- [x] Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ assign/revoke/get_events Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹
- [x] Celery Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° assign_access_level_task Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- [x] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² create_visit Ğ¸ finalize_guest_invitation
- [x] ĞœĞ¾Ğ´ĞµĞ»ÑŒ Visit Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸ ÑƒÑ‡Ñ‘Ñ‚Ğ°
- [x] ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹
- [x] Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° monitor_guest_passages_task Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°
- [x] Celery Beat Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾
- [x] Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹
- [x] ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [x] Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾
- [x] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ°

---

## ğŸ“ Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

### ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ 1 (ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ° Ñ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ»Ğ¸Ñ†Ğ°
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Celery Beat Ğ² production
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Prometheus Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

### ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ 2 (Ğ–ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
- [ ] UI Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² (dashboard)
- [ ] Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
- [ ] WebSocket real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ²
- [ ] Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ°Ğ¼ (Excel/PDF)

### ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ 3 (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
- [ ] ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ (Ğ, Ğ’, Ğ¡)
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ñ‡ĞµÑ€ĞµĞ· UI
- [ ] Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ· Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸
- [ ] Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ access level (audit trail)

---

## ğŸ‰ Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ñ Ğ¾Ğ´Ğ½Ğ¾Ñ€Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ¼/Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¾Ğ¼ **Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°**.

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ:**
1. âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ¾Ñ‚Ğ¾
2. âœ… ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ñ‚ÑƒÑ€Ğ½Ğ¸ĞºĞµÑ‚Ñ‹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
3. âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° (Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ’)
4. âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
5. âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

**Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº:**
- Django 5.0+ (ASGI, Channels)
- Celery + Redis (background tasks, scheduling)
- PostgreSQL (database)
- HikCentral Professional API v1 (access control)

**Ğ’Ñ€ĞµĞ¼Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** ~2 Ñ‡Ğ°ÑĞ°
**Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ¾
**Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº production:** 95% (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Celery Beat Ğ² prod)

---

Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ: 2025-10-02
ĞĞ²Ñ‚Ğ¾Ñ€: AI Agent (GitHub Copilot)
Ğ’ĞµÑ€ÑĞ¸Ñ: 1.0
