# Deployment Checklist

## Перед релизом
- [ ] Все изменения прошли ревью и смержены в `main`.
- [ ] CI (линтеры, тесты, security-сканы) зелёный для коммита релиза.
- [ ] Сформирован релизный `.env` (или secret set) для целевой среды.
- [ ] Проверены миграции (`poetry run python visitor_system/manage.py makemigrations --check`).
- [ ] Обновлён CHANGELOG/релизная заметка.

## Staging
- [ ] Задеплоен образ `visitor-system/web:<tag>` из CI.
- [ ] Запущен `docker-compose.prod.yml` (или Helm chart) с `RUN_MIGRATIONS=true`, `COLLECT_STATIC=true`.
- [ ] Прогонены smoke-тесты:
  - [ ] Создание гостя и назначение пропуска.
  - [ ] Автоматический check-in/out (мок/песочница HikCentral).
  - [ ] Отправка письма (консольный backend).
- [ ] Проверены метрики (Prometheus) и логи (stdout/Sentry).
- [ ] В staging нет ошибок уровня ERROR за последние 15 минут.

## Production
- [ ] Миграции прогнаны вручную (`RUN_MIGRATIONS=true` на коротко живущем job).
- [ ] Статика собрана и доступна через CDN/nginx.
- [ ] Основной сервис (`web`) и фоновые (`worker`, `beat`, `flower`) здоровы по healthcheck.
- [ ] Проверена авторизация через Azure AD (минимум 1 тестовая учётка).
- [ ] Триггернут Sentry тест (`/sentry-debug/` доступен только в dev/staging).
- [ ] Закрыт доступ к старым контейнерам/хостам.

## После релиза
- [ ] Отмониторить SLO/ошибки в течение 1 часа.
- [ ] Обновить эксплуатационный журнал (дата, версия, ответственный).
- [ ] Запланировать ротацию ключей (если проводилась).
